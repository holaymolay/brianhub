<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BrianHub Task MVP</title>
    <link rel="stylesheet" href="/apps/web/styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="header-left">
        <h1>BrianHub</h1>
      </div>
      <div class="sync-controls">
        <button id="sync-btn">Sync Now</button>
        <span id="sync-status">Local-first (offline ready)</span>
        <div class="workspace-menu-wrapper">
          <button id="notice-bell" class="icon-button menu-icon" type="button" title="Notices">üîî</button>
          <div id="notice-bell-menu" class="workspace-menu hidden"></div>
        </div>
        <div class="account-menu-wrapper">
          <button id="account-button" class="account-button" type="button" title="Account menu">
            <span id="account-avatar" class="account-avatar">BJ</span>
            <span class="account-caret">‚ñæ</span>
          </button>
          <div id="account-menu" class="account-menu hidden">
            <div class="account-menu-grid">
              <div class="account-menu-left">
                <div class="account-menu-title">Account</div>
                <button class="account-list-item is-active" type="button">
                  <span class="account-avatar small" id="account-list-avatar">BJ</span>
                  <span class="account-list-name" id="account-list-name">Organization</span>
                  <span class="account-list-dot"></span>
                  <span class="account-list-check">‚úì</span>
                </button>
                <button id="account-add" class="account-list-item subtle" type="button">Ôºã Add another account</button>
                <button id="account-logout" class="account-list-item subtle" type="button">‚Üí Log out</button>
              </div>
              <div class="account-menu-right">
                <div class="account-profile">
                  <span class="account-avatar large" id="account-profile-avatar">BJ</span>
                  <div class="account-profile-name" id="account-profile-name">Organization</div>
                  <div class="account-profile-email" id="account-profile-email">you@example.com</div>
                </div>
                <div class="account-divider"></div>
                <div class="account-workspaces">
                  <div class="account-menu-title">Workspaces</div>
                  <div class="account-workspace-row">
                    <div class="workspace-dropdown">
                      <button id="workspace-dropdown-button" class="workspace-dropdown-button" type="button">
                        Workspaces
                      </button>
                      <div id="workspace-list" class="workspace-list workspace-dropdown-list hidden"></div>
                    </div>
                    <div class="workspace-menu-wrapper">
                      <button id="workspace-menu-button" class="icon-button menu-icon workspace-menu-button" type="button" title="Workspace settings">‚ãØ</button>
                      <div id="workspace-menu" class="workspace-menu hidden">
                        <button id="new-workspace-btn" class="workspace-menu-item" type="button">New</button>
                        <button id="manage-workspaces-btn" class="workspace-menu-item" type="button">Manage</button>
                        <button id="archived-workspaces-btn" class="workspace-menu-item" type="button">Archive</button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="account-action-list">
                  <button id="account-admin" class="account-action" type="button">Admin console</button>
                  <button id="account-new-workspace" class="account-action" type="button">New workspace</button>
                  <button id="account-invite" class="account-action" type="button">Invite to BrianHub</button>
                  <button id="account-upgrade" class="account-action account-upgrade" type="button">Upgrade</button>
                </div>
                <div class="account-divider"></div>
                <div class="account-action-list">
                  <button id="profile-open" class="account-action" type="button">Profile</button>
                  <button id="settings-open" class="account-action" type="button">Settings</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="app-main">
      <div class="app-layout">
        <aside class="sidebar">
          <div class="sidebar-header-row">
            <button id="tasks-open" class="sidebar-section-button" type="button">My Tasks</button>
          </div>
          <div class="sidebar-divider"></div>
          <div class="sidebar-header-row">
            <h2>Projects</h2>
            <button id="new-project-btn" class="icon-button menu-icon" type="button" title="New project">Ôºã</button>
          </div>
          <div id="project-list" class="workspace-list"></div>
          <div class="sidebar-divider"></div>
          <div class="sidebar-header-row">
            <button id="workflows-open" class="sidebar-section-button" type="button">Workflows</button>
            <div class="sidebar-header-actions">
              <button id="workflow-sidebar-menu-button" class="icon-button menu-icon" type="button" title="Manage workflows">‚ãØ</button>
            </div>
          </div>
          <div id="workflow-list" class="workspace-list"></div>
          <div class="sidebar-divider"></div>
          <div class="sidebar-header-row">
            <h2>Shopping Lists</h2>
            <div class="sidebar-header-actions">
              <button id="new-shopping-list-btn" class="icon-button menu-icon" type="button" title="New shopping list">Ôºã</button>
              <div class="workspace-menu-wrapper">
                <button id="shopping-list-sidebar-menu-button" class="icon-button menu-icon" type="button" title="Shopping list menu">‚ãØ</button>
                <div id="shopping-list-sidebar-menu" class="workspace-menu hidden">
                  <label class="workspace-menu-item checkbox-item">
                    <input type="checkbox" id="show-archived-shopping" />
                    Show archived
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div id="shopping-list-list" class="workspace-list"></div>
          <div class="sidebar-divider"></div>
          <div class="sidebar-header-row">
            <button id="notices-open" class="sidebar-section-button" type="button">Notices</button>
            <button id="new-notice-sidebar-btn" class="icon-button menu-icon" type="button" title="New notice">Ôºã</button>
          </div>
          <div id="notice-list" class="workspace-list"></div>
        </aside>
        <section class="panel content-panel">
          <section id="tasks-panel">
            <div class="tasks-toolbar">
            <div class="task-filter">
              <button id="task-filter-button" class="subtle-button" type="button">All tasks ‚ñæ</button>
              <div id="task-filter-menu" class="workspace-menu hidden">
                <button class="workspace-menu-item" type="button" data-filter="all">All tasks</button>
                <button class="workspace-menu-item" type="button" data-filter="unassigned">Unassigned</button>
              </div>
            </div>
            <div class="task-view-toggle">
              <div class="task-sort">
                <button id="task-sort-button" class="subtle-button" type="button">Sort ‚ñæ</button>
                <div id="task-sort-menu" class="workspace-menu hidden">
                  <button class="workspace-menu-item" type="button" data-sort="default">Default</button>
                  <button class="workspace-menu-item" type="button" data-sort="due-asc">Due date (soonest)</button>
                  <button class="workspace-menu-item" type="button" data-sort="due-desc">Due date (latest)</button>
                </div>
              </div>
              <div class="task-group">
                <button id="task-group-button" class="subtle-button" type="button">Group by ‚ñæ</button>
                <div id="task-group-menu" class="workspace-menu hidden">
                  <button class="workspace-menu-item" type="button" data-group="none">None</button>
                  <button class="workspace-menu-item" type="button" data-group="section">Section</button>
                  <button class="workspace-menu-item" type="button" data-group="task-type">Task type</button>
                  <button class="workspace-menu-item" type="button" data-group="priority">Priority</button>
                </div>
              </div>
              <select id="task-view-select" class="task-view-select" aria-label="Task view">
                <option value="list">List view</option>
                <option value="kanban">Kanban view</option>
                <option value="calendar">Calendar view</option>
              </select>
              <button id="task-columns-button" class="subtle-button" type="button" title="Add section">Ôºã</button>
            </div>
            </div>
            <div id="task-bulk-bar" class="task-bulk-bar hidden">
              <span id="task-bulk-count" class="task-bulk-count">0 selected</span>
              <button id="task-bulk-edit" class="subtle-button" type="button">Bulk edit</button>
              <button id="task-bulk-delete" class="danger-button" type="button">Delete</button>
              <div class="task-bulk-undo">
                <button id="task-bulk-undo-button" class="subtle-button" type="button">Undo ‚ñæ</button>
                <div id="task-bulk-undo-menu" class="workspace-menu hidden"></div>
              </div>
              <button id="task-bulk-clear" class="subtle-button" type="button">Cancel</button>
            </div>
            <div id="task-tree"></div>
          </section>
          <section id="shopping-page" class="shopping-panel hidden">
            <div class="panel-header shopping-panel-header">
              <div class="shopping-header-left">
                <button id="shopping-back" class="subtle-button" type="button">‚Üê Tasks</button>
                <div>
                  <h2 id="shopping-list-title">Shopping Lists</h2>
                  <div id="shopping-list-subtitle" class="sidebar-note">Select a shopping list to view items.</div>
                </div>
              </div>
              <div class="shopping-panel-actions">
                <button id="shopping-add-item" class="icon-button shopping-add-button" type="button" title="Add items">Ôºã</button>
                <button id="shopping-list-menu-button" class="icon-button menu-icon" type="button" title="List actions">‚ãØ</button>
                <div id="shopping-list-menu" class="workspace-menu hidden">
                  <button id="shopping-list-rename" class="workspace-menu-item" type="button">Rename</button>
                  <button id="shopping-list-delete" class="workspace-menu-item" type="button">Delete</button>
                </div>
              </div>
            </div>
            <div id="shopping-list-items" class="shopping-items"></div>
            <div class="shopping-complete">
              <button id="shopping-complete-btn" type="button">Complete list</button>
            </div>
          </section>
          <section id="notices-page" class="panel hidden">
            <div class="panel-header">
              <div class="notice-header-left">
                <button id="notices-back" class="subtle-button" type="button">‚Üê Tasks</button>
                <h2>Notices</h2>
              </div>
              <button id="notices-add-btn" class="icon-button" type="button" title="New notice">Ôºã</button>
            </div>
            <div class="tasks-toolbar notices-toolbar">
              <div class="task-filter">
                <button id="notice-filter-button" class="subtle-button" type="button">All notices ‚ñæ</button>
                <div id="notice-filter-menu" class="workspace-menu hidden">
                  <button class="workspace-menu-item" type="button" data-filter="all">All notices</button>
                  <button class="workspace-menu-item" type="button" data-filter="upcoming">Upcoming</button>
                  <button class="workspace-menu-item" type="button" data-filter="overdue">Overdue</button>
                  <button class="workspace-menu-item" type="button" data-filter="today">Today</button>
                </div>
              </div>
              <div class="task-sort">
                <button id="notice-sort-button" class="subtle-button" type="button">Sort ‚ñæ</button>
                <div id="notice-sort-menu" class="workspace-menu hidden">
                  <button class="workspace-menu-item" type="button" data-sort="time-asc">Soonest</button>
                  <button class="workspace-menu-item" type="button" data-sort="time-desc">Latest</button>
                  <button class="workspace-menu-item" type="button" data-sort="title-asc">Title (A‚ÄìZ)</button>
                </div>
              </div>
            </div>
            <div id="notices-list" class="workspace-list"></div>
          </section>
          <section id="workflows-page" class="panel hidden">
            <div class="panel-header workflow-panel-header">
              <div class="notice-header-left">
                <button id="workflows-back" class="subtle-button" type="button">‚Üê Tasks</button>
                <div>
                  <h2 id="workflow-page-title">Manage Workflows</h2>
                  <div id="workflow-page-subtitle" class="sidebar-note">Select a blueprint to manage.</div>
                </div>
              </div>
              <div class="workflow-panel-actions">
                <button id="workflow-instance-add" class="icon-button" type="button" title="New workflow blueprint">Ôºã</button>
                <button id="workflow-menu-button" class="icon-button menu-icon" type="button" title="Blueprint actions">‚ãØ</button>
                <div id="workflow-menu" class="workspace-menu hidden">
                  <button id="workflow-rename" class="workspace-menu-item" type="button">Rename blueprint</button>
                  <button id="workflow-delete" class="workspace-menu-item" type="button">Delete blueprint</button>
                </div>
              </div>
            </div>
            <div id="workflow-detail" class="workflow-detail"></div>
          </section>
          <section id="workspace-manage-page" class="workspace-panel hidden">
            <div class="panel-header workspace-panel-header">
              <div class="shopping-header-left">
                <button id="workspace-manage-back" class="subtle-button" type="button">‚Üê Tasks</button>
                <div>
                  <h2>Manage Workspaces</h2>
                  <div class="sidebar-note">Rename, archive, or delete active workspaces.</div>
                </div>
              </div>
            </div>
            <div id="workspace-manage-list" class="workspace-list workspace-manage-list"></div>
          </section>
          <section id="workspace-archived-page" class="workspace-panel hidden">
            <div class="panel-header workspace-panel-header">
              <div class="shopping-header-left">
                <button id="workspace-archived-back" class="subtle-button" type="button">‚Üê Tasks</button>
                <div>
                  <h2>Archived Workspaces</h2>
                  <div class="sidebar-note">Restore or delete archived workspaces.</div>
                </div>
              </div>
            </div>
            <div id="workspace-archived-list" class="workspace-list workspace-manage-list"></div>
          </section>
        </section>
      </div>
    </main>

    <template id="task-item-template">
      <div class="task-item">
        <div class="task-row">
          <div class="task-main">
            <div class="task-title-row">
              <span class="task-drag-handle" aria-label="Drag task" title="Drag task"></span>
              <button class="task-complete-button icon-button" type="button" title="Mark complete">‚úì</button>
              <button class="task-toggle icon-button" type="button" title="Toggle subtasks">‚ñæ</button>
              <strong class="task-title"></strong>
              <span class="task-status-tag"></span>
            </div>
            <span class="task-meta"></span>
            <span class="task-type-badge"></span>
          </div>
          <div class="task-actions">
            <div class="task-menu-wrapper">
              <button class="task-menu-button icon-button menu-icon" type="button" title="More">‚ãØ</button>
              <div class="task-menu hidden">
                <button class="task-menu-item" type="button" data-action="subtask">Add subtask</button>
                <button class="task-menu-item" type="button" data-action="duplicate">Duplicate task</button>
                <button class="task-menu-item" type="button" data-action="edit">Edit task</button>
                <button class="task-menu-item" type="button" data-action="delete">Delete task</button>
                <button class="task-menu-item template-only hidden" type="button" data-action="start-template">Start plan</button>
                <button class="task-menu-item template-only hidden" type="button" data-action="defer-template">Defer</button>
                <button class="task-menu-item template-only hidden" type="button" data-action="dismiss-template">Dismiss</button>
              </div>
            </div>
          </div>
        </div>
        <div class="task-children"></div>
      </div>
    </template>

    <div id="task-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>New Task</h2>
        <form id="task-modal-form">
          <label>
            Task
            <input
              id="modal-title"
              type="text"
              name="task_title"
              placeholder="What needs to be done?"
              autocomplete="off"
              data-form-type="other"
              data-lpignore="true"
              data-1p-ignore="true"
              data-bwignore="true"
              required
            />
          </label>
          <label>
            Type
            <select id="modal-type"></select>
          </label>
          <label>
            Priority
            <select id="modal-priority">
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="low">Low</option>
              <option value="critical">Critical</option>
            </select>
          </label>
          <div class="recurrence-row">
            <button id="modal-recurring-button" class="icon-button subtle-button" type="button" title="Set repeat">‚Üª</button>
            <span id="modal-recurring-summary" class="recurrence-summary">No repeat</span>
          </div>
          <label>
            Status
            <select id="modal-status">
              <option value="inbox">Inbox</option>
              <option value="planned">Planned</option>
              <option value="in-progress">In Progress</option>
              <option value="waiting">Waiting</option>
              <option value="blocked">Blocked</option>
            </select>
          </label>
          <div class="datetime-row">
            <label>
              Start
              <input id="modal-start" type="datetime-local" />
            </label>
            <label>
              Due
              <input id="modal-due" type="datetime-local" />
            </label>
          </div>
          <label>
            Reminder (days before)
            <input id="modal-reminder" type="number" min="0" placeholder="0" />
          </label>
          <label>
            Notes
            <textarea id="modal-desc" rows="4"></textarea>
          </label>
          <div class="modal-actions">
            <button type="submit">Create</button>
            <button type="button" id="modal-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="checkin-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Did you do this?</h2>
        <div id="checkin-task-title" class="sidebar-note"></div>
        <div class="checkin-actions">
          <button type="button" id="checkin-yes">Yes</button>
          <button type="button" id="checkin-no" class="subtle-button">No</button>
          <button type="button" id="checkin-inprogress" class="subtle-button">In progress</button>
        </div>
        <div class="modal-actions">
          <button type="button" id="checkin-dismiss">Dismiss</button>
        </div>
      </div>
    </div>

    <div id="checkin-progress-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <div class="modal-header">
          <button type="button" id="checkin-progress-back" class="modal-back" aria-label="Back">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2>Finish this today?</h2>
        </div>
        <div id="checkin-progress-title" class="sidebar-note"></div>
        <div class="checkin-actions">
          <button type="button" id="checkin-progress-yes">Yes, keep due date</button>
          <button type="button" id="checkin-progress-no" class="subtle-button">No, reschedule</button>
        </div>
      </div>
    </div>

    <div id="checkin-no-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <div class="modal-header">
          <button type="button" id="checkin-no-back" class="modal-back" aria-label="Back">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2>Reschedule options</h2>
        </div>
        <div id="checkin-no-title" class="sidebar-note"></div>
        <div class="checkin-actions">
          <button type="button" id="checkin-no-extend">Extend session</button>
          <button type="button" id="checkin-no-first" class="subtle-button">Put first in list</button>
          <button type="button" id="checkin-no-reschedule" class="subtle-button">Reschedule</button>
        </div>
        <div class="modal-actions">
          <button type="button" id="checkin-no-dismiss" class="subtle-button">Dismiss</button>
        </div>
      </div>
    </div>

    <div id="checkin-reschedule-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <div class="modal-header">
          <button type="button" id="checkin-reschedule-back" class="modal-back" aria-label="Back">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <h2>Reschedule overdue task</h2>
        </div>
        <div id="checkin-reschedule-title" class="sidebar-note"></div>
        <label>
          Reschedule to (default tomorrow)
          <input id="checkin-custom-due" type="datetime-local" />
        </label>
        <div class="modal-actions">
          <button type="button" id="checkin-reschedule-apply">Reschedule</button>
          <button type="button" id="checkin-reschedule-cancel" class="subtle-button">Cancel</button>
        </div>
      </div>
    </div>

    <div id="template-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Template</h2>
        <form id="template-modal-form">
          <label>
            Name
            <input id="template-name" type="text" required />
          </label>
          <label>
            Steps (one per line, optional \"| -10\" for days before event)
            <textarea id="template-steps" rows="6" placeholder="Order flowers | -10&#10;Buy gift | -7&#10;Write card | -3"></textarea>
          </label>
          <label>
            Lead time (days before event to start)
            <input id="template-lead-days" type="number" min="0" placeholder="14" />
          </label>
          <label>
            Project (optional)
            <select id="template-project"></select>
          </label>
          <label>
            Next event date
            <input id="template-next-date" type="date" />
          </label>
          <label>
            Repeat every
            <div class="inline">
              <input id="template-repeat-interval" type="number" min="1" placeholder="1" />
              <select id="template-repeat-unit">
                <option value="year">Year</option>
                <option value="month">Month</option>
                <option value="week">Week</option>
                <option value="day">Day</option>
              </select>
            </div>
          </label>
          <div class="modal-actions">
            <button type="submit">Save</button>
            <button type="button" id="template-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    <div id="workflow-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2 id="workflow-modal-title">New Blueprint</h2>
        <form id="workflow-modal-form">
          <label>
            Blueprint name
            <input id="workflow-name" type="text" required />
          </label>
          <label>
            Description
            <textarea id="workflow-description" rows="3" placeholder="Optional notes about this blueprint"></textarea>
          </label>
          <div class="modal-actions">
            <button type="submit">Save</button>
            <button type="button" id="workflow-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    <div id="workflow-instance-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Start workflow</h2>
        <form id="workflow-instance-form">
          <label>
            Type
            <select id="workflow-instance-variant"></select>
          </label>
          <label>
            Workflow title
            <input id="workflow-instance-title" type="text" required />
          </label>
          <label>
            Notes
            <textarea id="workflow-instance-notes" rows="3" placeholder="Optional notes"></textarea>
          </label>
          <div class="modal-actions">
            <button type="submit">Start</button>
            <button type="button" id="workflow-instance-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="settings-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Settings</h2>
        <div class="settings-section">
          <h3>Notifications</h3>
          <div class="setting-row">
            <div class="setting-label">Enable notifications</div>
            <label class="toggle">
              <input id="enable-notifications" type="checkbox" />
              <span class="toggle-track"></span>
            </label>
          </div>
          <div id="notification-status" class="sidebar-note setting-help"></div>
        </div>
        <div class="settings-section">
          <h3>Check-ins</h3>
          <div class="setting-row">
            <div class="setting-label">Default session extension (minutes)</div>
            <input id="checkin-default-minutes" class="setting-input" type="number" min="5" step="5" />
          </div>
        </div>
        <div class="settings-section">
          <h3>Templates</h3>
          <div id="template-list" class="workspace-list"></div>
          <button id="new-template-btn" class="subtle-button" type="button">New Template</button>
        </div>
        <div class="settings-section">
          <h3>Task Types</h3>
          <button id="task-types-open" class="subtle-button" type="button">Manage task types</button>
        </div>
        <div class="settings-section">
          <h3>Stores</h3>
          <button id="store-rules-open" class="subtle-button" type="button">Manage stores</button>
        </div>
        <div class="modal-actions">
          <button type="button" id="settings-close">Close</button>
        </div>
      </div>
    </div>

    <div id="profile-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Profile</h2>
        <div class="sidebar-note">Profile settings coming soon.</div>
        <div class="modal-actions">
          <button type="button" id="profile-close">Close</button>
        </div>
      </div>
    </div>

    <div id="task-columns-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Kanban Sections</h2>
        <div id="task-columns-list" class="column-list"></div>
        <div class="column-add">
          <input id="task-column-name" type="text" placeholder="New section name" />
          <button id="task-column-add" type="button">Add section</button>
        </div>
        <div class="modal-actions">
          <button id="task-columns-close" type="button">Close</button>
        </div>
      </div>
    </div>

    <div id="task-types-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Task Types</h2>
        <div id="task-type-list" class="workspace-list"></div>
        <div class="task-type-add">
          <input id="task-type-name" type="text" placeholder="New type name" />
          <button id="task-type-add" class="subtle-button" type="button">Add type</button>
        </div>
        <div class="modal-actions">
          <button type="button" id="task-types-close">Close</button>
        </div>
      </div>
    </div>

    <div id="store-rules-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Stores</h2>
        <div id="store-rule-list" class="workspace-list"></div>
        <div class="store-rule-add">
          <input id="store-rule-name" type="text" placeholder="Store name" />
          <input id="store-rule-keywords" type="text" placeholder="Keywords (optional, comma separated)" />
          <button id="store-rule-add" class="subtle-button" type="button">Add store</button>
        </div>
        <div class="modal-actions">
          <button type="button" id="store-rules-close">Close</button>
        </div>
      </div>
    </div>

    <div id="kanban-column-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>New Kanban Section</h2>
        <form id="kanban-column-form">
          <label>
            Section name
            <input id="kanban-column-name" type="text" required />
          </label>
          <div class="modal-actions">
            <button type="submit">Create section</button>
            <button type="button" id="kanban-column-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="recurrence-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Repeat</h2>
        <form id="recurrence-form">
          <label>
            Repeat every
            <div class="inline">
              <input id="recurrence-interval" type="number" min="1" placeholder="1" />
              <select id="recurrence-unit">
                <option value="day">Day</option>
                <option value="week">Week</option>
                <option value="month">Month</option>
                <option value="year">Year</option>
              </select>
            </div>
          </label>
          <div class="modal-actions">
            <button type="submit">Save</button>
            <button type="button" id="recurrence-clear">Clear</button>
            <button type="button" id="recurrence-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

      <div id="notice-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>New Notice</h2>
        <form id="notice-form">
          <label>
            Title
            <input id="notice-title" type="text" required />
          </label>
          <label>
            Type
            <select id="notice-type"></select>
          </label>
          <label id="notice-type-new-row" class="hidden">
            New type
            <input id="notice-type-new" type="text" placeholder="Chore notice" />
          </label>
          <label>
            Notify me at
            <input id="notice-at" type="datetime-local" required />
          </label>
          <div class="modal-actions">
            <button type="submit" id="notice-save">Create</button>
            <button type="button" id="notice-dismiss" class="danger-button hidden">Dismiss</button>
            <button type="button" id="notice-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <aside id="task-editor" class="task-editor">
      <div class="task-editor-header">
        <h2>Edit Task</h2>
        <button id="editor-close" class="task-editor-close" type="button" title="Close">‚Üí</button>
      </div>
      <div id="task-editor-body" class="task-editor-body">
        <form id="task-editor-form" class="task-editor-form">
          <label class="span-2">
            Task
            <input
              id="editor-title"
              type="text"
              name="task_title"
              placeholder="What needs to be done?"
              autocomplete="off"
              data-form-type="other"
              data-lpignore="true"
              data-1p-ignore="true"
              data-bwignore="true"
              required
            />
          </label>
          <label>
            Type
            <select id="editor-type"></select>
          </label>
          <label>
            Project
            <select id="editor-project"></select>
          </label>
          <label>
            Priority
            <select id="editor-priority">
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="low">Low</option>
              <option value="critical">Critical</option>
            </select>
          </label>
          <label>
            Status
            <select id="editor-status">
              <option value="inbox">Inbox</option>
              <option value="planned">Planned</option>
              <option value="in-progress">In Progress</option>
              <option value="waiting">Waiting</option>
              <option value="blocked">Blocked</option>
              <option value="done">Done</option>
              <option value="canceled">Canceled</option>
            </select>
          </label>
          <div class="recurrence-row">
            <button id="editor-recurring-button" class="icon-button subtle-button" type="button" title="Set repeat">‚Üª</button>
            <span id="editor-recurring-summary" class="recurrence-summary">No repeat</span>
          </div>
          <label>
            Due
            <input id="editor-due" type="datetime-local" />
          </label>
          <label>
            Reminder (days before)
            <input id="editor-reminder" type="number" min="0" placeholder="0" />
          </label>
          <div id="editor-followup-section" class="task-editor-followup span-2 hidden">
            <label>
              Follow-up
              <input id="editor-followup" type="datetime-local" />
            </label>
            <div class="task-editor-followup-actions">
              <button id="editor-followup-now" type="button" class="subtle-button">Follow up now</button>
              <button id="editor-followup-snooze" type="button" class="subtle-button">Snooze 3 days</button>
              <button id="editor-followup-clear" type="button" class="subtle-button">Clear follow-up</button>
            </div>
          </div>
          <div class="task-editor-field span-2">
            <div class="task-editor-label">Notes</div>
            <div class="notes-editor is-rich" id="notes-editor">
              <div class="notes-toolbar">
                <div class="notes-toolbar-left">
                  <button type="button" class="notes-btn" data-command="heading" data-level="1">H1</button>
                  <button type="button" class="notes-btn" data-command="heading" data-level="2">H2</button>
                  <button type="button" class="notes-btn" data-command="bold"><strong>B</strong></button>
                  <button type="button" class="notes-btn" data-command="italic"><em>I</em></button>
                  <button type="button" class="notes-btn" data-command="bullet">‚Ä¢ List</button>
                  <button type="button" class="notes-btn" data-command="ordered">1. List</button>
                  <button type="button" class="notes-btn" data-command="quote">Quote</button>
                  <button type="button" class="notes-btn" data-command="code">Code</button>
                  <button type="button" class="notes-btn" data-command="codeblock">Code block</button>
                  <button type="button" class="notes-btn" data-command="link">Link</button>
                </div>
                <div class="notes-toolbar-right">
                  <button type="button" class="notes-btn notes-mode" data-mode="markdown">MD</button>
                </div>
              </div>
              <div id="editor-notes" class="editor-notes"></div>
              <textarea id="editor-desc" class="editor-desc-fallback" rows="6" placeholder="Write notes..."></textarea>
            </div>
          </div>
          <label class="span-2">
            Subtask of
            <select id="editor-parent"></select>
          </label>
          <div class="task-editor-subtasks span-2">
            <div class="task-editor-subtasks-header">
              <span>Subtasks</span>
              <span id="editor-subtask-count" class="task-editor-subtasks-count"></span>
            </div>
            <div id="editor-subtask-list" class="task-editor-subtasks-list"></div>
          </div>
          <div class="task-editor-deps span-2">
            <div class="task-editor-deps-header">
              <span>Dependencies</span>
              <span id="editor-dependency-count" class="task-editor-subtasks-count"></span>
            </div>
            <div class="task-editor-deps-controls">
              <select id="editor-dependency-select">
                <option value="">Select task...</option>
              </select>
              <button id="editor-add-dependency" type="button" class="subtle-button">Add</button>
            </div>
            <div id="editor-dependency-list" class="task-editor-deps-list"></div>
          </div>
          <div class="task-editor-actions span-2">
            <button type="submit">Save</button>
            <button id="editor-cancel" type="button">Cancel</button>
            <button id="editor-delete" class="danger-button" type="button">Delete</button>
          </div>
        </form>
      </div>
      <div class="task-editor-scrollbar" id="task-editor-scrollbar">
        <div class="task-editor-scroll-thumb" id="task-editor-scroll-thumb"></div>
      </div>
    </aside>

    <div id="shopping-list-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>New Shopping List</h2>
        <form id="shopping-list-form">
          <label>
            Store
            <select id="shopping-list-store-select">
              <option value="">Select store...</option>
              <option value="__add_new__">Add new store‚Ä¶</option>
            </select>
          </label>
          <label id="shopping-list-store-new-row" class="hidden">
            New store
            <input id="shopping-list-store-new" type="text" placeholder="Safeway" />
          </label>
          <label>
            Date
            <input id="shopping-list-date" type="date" required />
          </label>
          <label>
            Items (comma or line separated)
            <textarea id="shopping-list-items-input" rows="4" placeholder="Milk, eggs, bread"></textarea>
          </label>
          <button id="shopping-list-parse" class="subtle-button" type="button">Parse items</button>
          <div class="modal-actions">
            <button type="submit">Create</button>
            <button type="button" id="shopping-list-cancel">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="shopping-item-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Add items</h2>
        <form id="shopping-item-form" class="shopping-item-form">
          <label>
            Items (comma or line separated)
            <textarea id="shopping-item-input" rows="4" placeholder="Milk, eggs, bread"></textarea>
          </label>
          <div class="shopping-item-actions">
            <button id="shopping-item-parse" class="subtle-button" type="button">Parse items</button>
            <button type="submit">Add items</button>
            <button id="shopping-item-cancel" class="subtle-button" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="template-prompt" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2 id="template-prompt-title">Start planning?</h2>
        <div id="template-prompt-text" class="sidebar-note"></div>
        <div class="modal-actions">
          <button id="template-prompt-start" type="button">Start now</button>
          <button id="template-prompt-defer" type="button">Defer</button>
          <button id="template-prompt-dismiss" class="subtle-button" type="button">Dismiss</button>
        </div>
      </div>
    </div>

    <div id="bulk-edit-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Bulk edit tasks</h2>
        <div id="bulk-edit-count" class="sidebar-note"></div>
        <form id="bulk-edit-form" class="bulk-edit-form">
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-status" type="checkbox" /> Status</span>
            <select id="bulk-edit-status"></select>
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-priority" type="checkbox" /> Priority</span>
            <select id="bulk-edit-priority">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-project" type="checkbox" /> Project</span>
            <select id="bulk-edit-project"></select>
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-type" type="checkbox" /> Type</span>
            <select id="bulk-edit-type"></select>
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-start" type="checkbox" /> Start date</span>
            <input id="bulk-edit-start" type="datetime-local" />
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-due" type="checkbox" /> Due date</span>
            <input id="bulk-edit-due" type="datetime-local" />
          </label>
          <label class="bulk-edit-field">
            <span><input id="bulk-edit-apply-reminder" type="checkbox" /> Reminder (days before)</span>
            <input id="bulk-edit-reminder" type="number" min="0" placeholder="0" />
          </label>
          <div class="modal-actions">
            <button type="submit">Apply changes</button>
            <button id="bulk-edit-cancel" class="subtle-button" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="group-rename-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-card">
        <h2>Rename section</h2>
        <form id="group-rename-form">
          <label>
            Section name
            <input id="group-rename-input" type="text" autocomplete="off" />
          </label>
          <div class="modal-actions">
            <button type="submit">Rename</button>
            <button id="group-rename-cancel" class="subtle-button" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <div id="task-context-menu" class="workspace-menu task-context-menu hidden"></div>
    <script type="module" src="/apps/web/app.js"></script>
  </body>
</html>
